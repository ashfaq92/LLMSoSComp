system_prompt = """You are an expert IoT system developer, proficient with Web of Things (WoT) descriptions and Node-RED workflow programming. Ensure that all node IDs are unique. Ensure that quote marks used within strings are handled. Ensure your response is valid JSON. Your job is to take new IoT system proposals/descriptions (from users) along with a list of the devices that are available to use (as WoT Thing descriptions). From this information, you will produce an IoT system workflow, for use within Node-RED, which connects the relevant Things/devices in order to satisfy the requirements of the provided system proposal/description.
Only output the generated workflow, no other explanation or text can be provided."""


system_prompt_cot = """You are an expert IoT system developer, proficient in Web of Things (WoT) descriptions and Node-RED workflow programming.

Your task:
- Take the user's IoT system request (written in natural language) and the list of available WoT Thing Descriptions.
- Internally break the problem down into subproblems.
- Internally solve each subproblem step-by-step.
- Internally merge the solutions into a full Node-RED workflow.
- Ensure all node IDs are unique.
- Ensure all quote marks are escaped properly.
- Ensure the final output is valid JSON representing the Node-RED workflow.

Important:
- You MUST NOT output your reasoning, analysis, chain of thought, or subproblem list.
- You MUST ONLY output the final JSON workflow, with no extra text.
"""


smart_home_system_description = """
  Blink LEDs when washing machine cycle has finished. 

  Turn on the main room light when motion is detected in that room. 
  
  When the door bell is pressed, reduce the speaker volume, make the smart assistant alert the homeowner of the doorbell, return the speaker’s volume. 
  
  When morning alarm triggers, turn heating on to 30 degrees C for 20mins.
"""

# smart home TD without endpoints specified
smart_home_td_simple = """
  [{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Alarm","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"alarmRinging":{"title":"Alarm Ringing","description":"This alarm has started ringing","subscription":{},"data":{"type":"null"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"DoorBell","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"bellRung":{"title":"Bell rung","description":"The bell was rung","subscription":{},"data":{"type":"null"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Heater","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"startHeater":{"type":"","title":"Start heater","description":"Starts the heater at the given temperature for the given time","input":{"type":"object","properties":{"temperature":{"type":"integer","description":"The temperature in degrees C to set for this heater"},"timeHeating":{"type":"integer","description":"The number of minutes to continue heat for"}}},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"LEDs","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"blink":{"type":"","title":"Blink LEDs","description":"Blinks the LEDs","forms":[]},"LEDsOn":{"type":"","title":"Turn LEDs on","description":"Turns on the LEDs","forms":[]},"LEDsOff":{"type":"","title":"Turn LEDs off","description":"Turns off the LEDs","forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"MainRoomLight","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"lightOn":{"type":"","title":"Turn light on","description":"Turns the light on","forms":[]},"lightOff":{"type":"","title":"Turn light off","description":"Turns the light off","forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"MotionSensor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"motionDetected":{"title":"Motion detected","description":"An event made when motion is detected","subscription":{},"data":{"type":"null"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"SmartAssistant","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"say":{"type":"","title":"Say phrase","description":"Makes the assistant say the given phrase","input":{"type":"object","properties":{"phrase":{"type":"string","description":"The phrase to be spoken by this assistant"}}},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Speaker","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"setVolume":{"type":"","title":"Set volume","description":"Sets the volume of this speaker","input":{"type":"object","properties":{"percentage":{"type":"integer","description":"The volume percentage to set this speaker to"}}},"forms":[]},"getVolume":{"type":"","title":"Get volume","description":"Gets the volume of this speaker","output":{"type":"integer"},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"WashingMachine","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"finishedCycle":{"title":"Wash cycle complete","description":"Sends a notification at the end of a wash cycle","subscription":{},"data":{"type":"null"},"cancellation":{},"forms":[]}}}]"""

# smart home full td with endpoints specified
smart_home_td_full = """
  [{"@context":"http://www.w3.org/ns/td","@type":["Thing"],"title":"WashingMachine","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"status":{"title":"Machine Status","description":"Current state of the washing machine","type":"string","enum":["idle","running","finished"],"readOnly":true,"forms":[{"href":"http://localhost:1880/things/wm/status","contentType":"application/json","op":["readproperty"]}]},"remainingTime":{"title":"Time Left","description":"Remaining wash cycle time in minutes","type":"integer","unit":"minutes","readOnly":true,"forms":[{"href":"http://localhost:1880/things/wm/remainingTime","contentType":"application/json","op":["readproperty"]}]}},"actions":{"start":{"title":"Start Washing Cycle","description":"Start a new wash program","input":{"type":"string","enum":["quick","cotton","wool"]},"forms":[{"href":"http://localhost:1880/things/wm/start","contentType":"application/json","op":["invokeaction"]}]},"stop":{"title":"Stop Cycle","description":"Immediately stop the wash program","forms":[{"href":"http://localhost:1880/things/wm/stop","contentType":"application/json","op":["invokeaction"]}]}},"events":{"finishedCycle":{"title":"Wash cycle complete","description":"Sends a notification at the end of a wash cycle","data":{"type":"string"},"forms":[{"href":"ws://localhost:1880/things/wm/finishedCycle","subprotocol":"websocket","contentType":"application/json","op":["subscribeevent"]},{"href":"http://localhost:1880/things/wm/finishedCycle","subprotocol":"longpoll"}]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"DoorBell","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"enabled":{"title":"Enabled","description":"Whether the doorbell is active","type":"boolean","readOnly":false,"forms":[{"href":"http://localhost:1880/doorbell/enabled","contentType":"application/json","op":["readproperty","writeproperty"]}]},"lastRung":{"title":"Last Rung","description":"Timestamp of the last ring","type":"string","readOnly":true,"forms":[{"href":"http://localhost:1880/doorbell/lastRung","contentType":"application/json","op":["readproperty"]}]}},"actions":{"toggle":{"title":"Enable/Disable Doorbell","description":"Invert the current enabled state","forms":[{"href":"http://localhost:1880/doorbell/toggle","contentType":"application/json","op":["invokeaction"]}]},"ring":{"title":"Ring Doorbell","description":"Manually trigger the bell","forms":[{"href":"http://localhost:1880/doorbell/ring","contentType":"application/json","op":["invokeaction"]}]}},"events":{"bellRung":{"title":"Bell rung","description":"The bell was rung","data":{"type":"string"},"forms":[{"href":"http://localhost:1880/doorbell/bellRung","subprotocol":"longpoll"}]}}},{"@context":["[http://www.w3.org/ns/td](http://www.w3.org/ns/td)"],"@type":["Thing"],"title":"MainRoomLight","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"status":{"title":"Light status","description":"Current state of the main room light","type":"string","enum":["on","off"],"readOnly":true,"forms":[{"href":"http://localhost:1880/things/mainroomlight/status","contentType":"application/json","op":["readproperty"]}]}},"actions":{"lightOn":{"title":"Turn light on","description":"Turns the light on","forms":[{"href":"http://localhost:1880/things/mainroomlight/on","contentType":"application/json","op":["invokeaction"]}]},"lightOff":{"title":"Turn light off","description":"Turns the light off","forms":[{"href":"http://localhost:1880/things/mainroomlight/off","contentType":"application/json","op":["invokeaction"]}]}},"events":{"lightStateChanged":{"title":"Light state changed","description":"Emitted whenever the main room light changes state","data":{"type":"string"},"forms":[{"href":"ws://localhost:1880/things/mainroomlight/lightStateChanged","subprotocol":"websocket","contentType":"application/json","op":["subscribeevent"]}]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Speaker","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"volume":{"title":"Volume","description":"The current volume percentage","type":"integer","forms":[{"href":"http://localhost:1880/things/speaker/volume","contentType":"application/json","op":["readproperty"]}]}},"actions":{"setVolume":{"title":"Set volume","description":"Sets the volume of this speaker","input":{"type":"object","properties":{"percentage":{"type":"integer","minimum":0,"maximum":100,"description":"The volume percentage (0–100)"}},"required":["percentage"]},"forms":[{"href":"http://localhost:1880/things/speaker/setVolume","contentType":"application/json","op":["invokeaction"]}]},"getVolume":{"title":"Get volume","description":"Gets the current volume of this speaker","output":{"type":"integer"},"forms":[{"href":"http://localhost:1880/things/speaker/getVolume","contentType":"application/json","op":["invokeaction"]}]}},"events":{}},{"@context":["[http://www.w3.org/ns/td](http://www.w3.org/ns/td)"],"@type":["Thing"],"title":"Alarm","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"time":{"title":"Alarm Time","description":"The scheduled alarm time in HH:MM format","type":"string","readOnly":false,"forms":[{"href":"http://localhost:1880/alarm/time","contentType":"application/json","op":["readproperty","writeproperty"]}]},"enabled":{"title":"Enabled","description":"Whether the alarm is active","type":"boolean","readOnly":false,"forms":[{"href":"http://localhost:1880/alarm/enabled","contentType":"application/json","op":["readproperty","writeproperty"]}]}},"actions":{"setTime":{"title":"Set Alarm Time","input":{"type":"string","pattern":"^([01]?[0-9]|2[0-3]):[0-5][0-9]$"},"forms":[{"href":"http://localhost:1880/alarm/setTime","contentType":"application/json","op":["invokeaction"]}]},"toggle":{"title":"Enable/Disable Alarm","input":{"type":"boolean"},"forms":[{"href":"http://localhost:1880/alarm/toggle","contentType":"application/json","op":["invokeaction"]}]},"stop":{"title":"Stop Alarm","description":"Stops the ringing alarm","forms":[{"href":"http://localhost:1880/alarm/stop","contentType":"application/json","op":["invokeaction"]}]}},"events":{"alarmRinging":{"title":"Alarm Ringing","description":"This alarm has started ringing","data":{"type":"string"},"forms":[{"href":"http://localhost:1880/alarm/ringing","subprotocol":"longpoll"}]}}},{"@context":["[http://www.w3.org/ns/td](http://www.w3.org/ns/td)"],"@type":["Thing"],"title":"Heater","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"temperature":{"title":"Current temperature","description":"Shows the target temperature of the heater (°C)","type":"integer","readOnly":true,"forms":[{"href":"http://localhost:1880/things/heater/status","contentType":"application/json","op":["readproperty"]}]},"timeHeating":{"title":"Time heating","description":"Remaining heating time in minutes","type":"integer","readOnly":true,"forms":[{"href":"http://localhost:1880/things/heater/status","contentType":"application/json","op":["readproperty"]}]},"status":{"title":"Status","description":"Current heater status","type":"string","enum":["on","off"],"readOnly":true,"forms":[{"href":"http://localhost:1880/things/heater/status","contentType":"application/json","op":["readproperty"]}]}},"actions":{"startHeater":{"title":"Start heater","description":"Starts the heater at the given temperature for the given time","input":{"type":"object","properties":{"temperature":{"type":"integer","description":"The temperature in degrees C"},"timeHeating":{"type":"integer","description":"Minutes to keep heater on"}},"required":["temperature","timeHeating"]},"forms":[{"href":"http://localhost:1880/things/heater/startHeater","contentType":"application/json","op":["invokeaction"]}]},"stopHeater":{"title":"Stop heater","description":"Stops the heater immediately","forms":[{"href":"http://localhost:1880/things/heater/stopHeater","contentType":"application/json","op":["invokeaction"]}]}},"events":{"heaterStopped":{"title":"Heater stopped","description":"Raised when the heater stops (timeout or manual stop)","data":{"type":"string"},"forms":[{"href":"ws://localhost:1880/things/heater/heaterStopped","subprotocol":"websocket","contentType":"application/json","op":["subscribeevent"]}]}}},{"@context":["[http://www.w3.org/ns/td](http://www.w3.org/ns/td)"],"@type":["Thing"],"title":"LEDs","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{"status":{"title":"LED Status","description":"Current state of the LEDs","type":"string","enum":["on","off","blinking"],"readOnly":true,"forms":[{"href":"http://localhost:1880/things/leds/status","contentType":"application/json","op":["readproperty"]}]}},"actions":{"blink":{"title":"Blink LEDs","description":"Blinks the LEDs","forms":[{"href":"http://localhost:1880/things/leds/blink","contentType":"application/json","op":["invokeaction"]}]},"LEDsOn":{"title":"Turn LEDs on","description":"Turns on the LEDs","forms":[{"href":"http://localhost:1880/things/leds/on","contentType":"application/json","op":["invokeaction"]}]},"LEDsOff":{"title":"Turn LEDs off","description":"Turns off the LEDs","forms":[{"href":"http://localhost:1880/things/leds/off","contentType":"application/json","op":["invokeaction"]}]}},"events":{"ledStateChanged":{"title":"LED state changed","description":"Emitted when the LED status changes","data":{"type":"string"},"forms":[{"href":"ws://localhost:1880/things/leds/ledStateChanged","subprotocol":"websocket","contentType":"application/json","op":["subscribeevent"]}]}}},{"@context":["[http://www.w3.org/ns/td](http://www.w3.org/ns/td)"],"@type":["Thing"],"title":"MotionSensor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","properties":{},"actions":{},"events":{"motionDetected":{"title":"Motion detected","description":"An event emitted when motion is detected","data":{"type":"string","description":"Timestamp when motion was detected"},"forms":[{"href":"ws://localhost:1880/things/motionsensor/motiondetected","subprotocol":"wot","contentType":"application/json","op":["subscribeevent","unsubscribeevent"]}]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"SmartAssistant","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"say":{"title":"Say phrase","description":"Makes the assistant say the given phrase","input":{"type":"object","properties":{"phrase":{"type":"string","description":"The phrase to be spoken by this assistant"}},"required":["phrase"]},"forms":[{"href":"http://localhost:1880/things/smartassistant/say","contentType":"application/json","op":["invokeaction"]}]}},"properties":{},"events":{}}]
"""


smart_home_expected_output = """
  [{"id":"f9b3862c37de7540","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"217abbfc1f693172","type":"system-event-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"finishedCycle","thingEventValue":"{\"uri\":\"http://localhost:1880/washingmachine\",\"output\":{},\"description\":\"Sends a notification at the end of a wash cycle\",\"title\":\"Wash cycle complete\",\"event\":\"finishedCycle\"}","outputToMsg":true,"redeploy":"true","x":130,"y":180,"wires":[["2f3782618f258063"]]},{"id":"2f3782618f258063","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"blink","thingActionValue":"{\"uri\":\"http://localhost:1880/leds\",\"params\":{},\"description\":\"Blinks the LEDs\",\"title\":\"Blink LEDs\",\"action\":\"blink\"}","outputToMsg":false,"redeploy":"false","x":290,"y":180,"wires":[[]]},{"id":"05f45c7e3bb710aa","type":"system-event-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"motionDetected","thingEventValue":"{\"uri\":\"http://localhost:1880/motionsensor\",\"output\":{},\"description\":\"An event made when motion is detected\",\"title\":\"Motion detected\",\"event\":\"motionDetected\"}","outputToMsg":true,"redeploy":"true","x":120,"y":240,"wires":[["f7dabb5eca2b6431"]]},{"id":"f7dabb5eca2b6431","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"lightOn","thingActionValue":"{\"uri\":\"http://localhost:1880/mainroomlight\",\"params\":{},\"description\":\"Turns the light on\",\"title\":\"Turn light on\",\"action\":\"lightOn\"}","outputToMsg":true,"redeploy":"false","x":300,"y":240,"wires":[[]]},{"id":"1c5fde08fe6eb27b","type":"system-event-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"bellRung","thingEventValue":"{\"uri\":\"http://localhost:1880/doorbell\",\"output\":{},\"description\":\"The bell was rung\",\"title\":\"Bell rung\",\"event\":\"bellRung\"}","outputToMsg":true,"redeploy":"false","x":140,"y":300,"wires":[["6cea9c151241fb5a"]]},{"id":"6cea9c151241fb5a","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"getVolume","thingActionValue":"{\"uri\":\"http://localhost:1880/speaker\",\"params\":{},\"output\":{\"type\":\"integer\"},\"description\":\"Gets the volume of this speaker\",\"title\":\"Get volume\",\"action\":\"getVolume\"}","outputToMsg":true,"redeploy":"false","x":310,"y":300,"wires":[["ed691035b7ee9bf0"]]},{"id":"f7981790f6b20a49","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"say","thingActionValue":"{\"uri\":\"http://localhost:1880/smartassistant\",\"params\":{\"phrase\":\"string\"},\"description\":\"Makes the assistant say the given phrase\",\"title\":\"Say phrase\",\"action\":\"say\"}","outputToMsg":true,"redeploy":"true","x":470,"y":380,"wires":[["0d56f275daf443a2"]]},{"id":"df740718fcfc0f27","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"setVolume","thingActionValue":"{\"uri\":\"http://localhost:1880/speaker\",\"params\":{\"percentage\":\"integer\"},\"description\":\"Sets the volume of this speaker\",\"title\":\"Set volume\",\"action\":\"setVolume\"}","outputToMsg":false,"redeploy":"true","x":490,"y":340,"wires":[["a1db2dee1bad5c9e"]]},{"id":"ed9d721063fa0df3","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"setVolume","thingActionValue":"{\"uri\":\"http://localhost:1880/speaker\",\"params\":{\"percentage\":\"integer\"},\"description\":\"Sets the volume of this speaker\",\"title\":\"Set volume\",\"action\":\"setVlume\"}","outputToMsg":false,"redeploy":"true","x":510,"y":420,"wires":[[]]},{"id":"ed691035b7ee9bf0","type":"function","z":"f9b3862c37de7540","name":"Store initial value","func":"msg.initialValue = msg.payload;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":490,"y":300,"wires":[["19d0e775158873f0"]]},{"id":"19d0e775158873f0","type":"function","z":"f9b3862c37de7540","name":"Quiet Volume","func":"msg.payload = 10;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":340,"wires":[["df740718fcfc0f27"]]},{"id":"a1db2dee1bad5c9e","type":"function","z":"f9b3862c37de7540","name":"Create Phrase","func":"msg.payload = \"The door bell has been rung\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":380,"wires":[["f7981790f6b20a49"]]},{"id":"0d56f275daf443a2","type":"function","z":"f9b3862c37de7540","name":"Restore initial value","func":"msg.payload = msg.initialValue;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":420,"wires":[["ed9d721063fa0df3"]]},{"id":"84d971f80ab03d50","type":"system-event-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"alarmRinging","thingEventValue":"{\"uri\":\"http://localhost:1880/alarm\",\"output\":{},\"description\":\"This alarm has started ringing\",\"title\":\"Alarm Ringing\",\"event\":\"alarmRinging\"}","outputToMsg":true,"redeploy":"false","x":130,"y":480,"wires":[["b3603706ef0b253a"]]},{"id":"b3603706ef0b253a","type":"function","z":"f9b3862c37de7540","name":"Set params","func":"msg.payload = [30, 20]\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":480,"wires":[["b6804e63dd953322"]]},{"id":"b6804e63dd953322","type":"system-action-node","z":"f9b3862c37de7540","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"startHeater","thingActionValue":"{\"uri\":\"http://localhost:1880/heater\",\"params\":{\"temperature\":\"integer\",\"timeHeating\":\"integer\"},\"description\":\"Starts the heater at the given temperature for the given time\",\"title\":\"Start heater\",\"action\":\"startHeater\"}","outputToMsg":true,"redeploy":"false","x":470,"y":480,"wires":[[]]}]
"""


manufacturing_system_description = """
  When a quality, temperature, or vibration alert is made, send this data for analysis. Once data analysis is complete log the result as well as analysing it for indications that maintenance is needed. If maintenance is needed, alert the manager of this. Additionally, send the result of data analysis to be analysed for efficiency and alert the manager of this too.

  Send quality alerts directly to the manager.

  When resources are used, alert the manager of the usage, and log it in the database.
"""

manufacturing_expected_output = """
  [{"id":"ec66bca55939c9e9","type":"tab","label":"Flow 1","disabled":false,"info":"","env":[]},{"id":"91955d31fa745dd4","type":"system-event-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"newQualityData","thingEventValue":"{\"uri\":\"http://localhost:1880/qualityinspector\",\"output\":{\"type\":\"string\",\"description\":\"Details about the quality of products\"},\"description\":\"Alerts when new quality data is ready for processing\",\"title\":\"New quality data\",\"event\":\"newQualityData\"}","outputToMsg":true,"redeploy":"true","x":120,"y":200,"wires":[["5bf3eea765f7ca7a","3bb0c2950a4e47f9"]]},{"id":"158964f562184c97","type":"system-event-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"temperatureAlert","thingEventValue":"{\"uri\":\"http://localhost:1880/temperaturetracker\",\"output\":{\"type\":\"number\",\"description\":\"The current temperature of machines\"},\"description\":\"Produces an alert with the current temperature of machines\",\"title\":\"Temperature alert\",\"event\":\"temperatureAlert\"}","outputToMsg":true,"redeploy":"true","x":120,"y":280,"wires":[["7da9cf95e81e8a24"]]},{"id":"0b35425b3a2bbd71","type":"system-event-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"vibrationAlert","thingEventValue":"{\"uri\":\"http://localhost:1880/vibrationmonitor\",\"output\":{\"type\":\"number\",\"description\":\"The amplitude of the current vibration of the machines\"},\"description\":\"Created a notification of the current vibration of machines\",\"title\":\"Vibration alert\",\"event\":\"vibrationAlert\"}","outputToMsg":true,"redeploy":"true","x":110,"y":360,"wires":[["13d27a83ec253b04"]]},{"id":"d4c89f71c650dd32","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"processSensorData","thingActionValue":"{\"uri\":\"http://localhost:1880/sensorhub\",\"params\":{\"sensorName\":\"string\",\"data\":\"string\"},\"description\":\"Adds the provided sensor data for processing\",\"title\":\"Process sensor data\",\"action\":\"processSensorData\"}","outputToMsg":true,"redeploy":"true","x":390,"y":320,"wires":[[]]},{"id":"4d34410bcd990e0f","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"reviewForMaintenance","thingActionValue":"{\"uri\":\"http://localhost:1880/maintenancemonitor\",\"params\":{},\"output\":{\"type\":\"boolean\",\"description\":\"Whether or not the system needs maintenance\"},\"description\":\"Reviews a system's status for issues that may need maintenance\",\"title\":\"Review for maintenance\",\"action\":\"reviewForMaintenance\"}","outputToMsg":true,"redeploy":"false","x":460,"y":520,"wires":[["90186fae4671c26b"]]},{"id":"dd07b6d2c9d8508c","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"logData","thingActionValue":"{\"uri\":\"http://localhost:1880/database\",\"params\":{},\"description\":\"Logs the input data\",\"title\":\"Log data\",\"action\":\"logData\"}","outputToMsg":true,"redeploy":"false","x":420,"y":460,"wires":[[]]},{"id":"235d1415f23c0e83","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertManager","thingActionValue":"{\"uri\":\"http://localhost:1880/managersdevice\",\"params\":{\"alertType\":\"string\",\"alertContent\":\"string\"},\"description\":\"Makes an alert on the manager's device\",\"title\":\"Alert the manager\",\"action\":\"alertManager\"}","outputToMsg":true,"redeploy":"true","x":950,"y":520,"wires":[[]]},{"id":"90186fae4671c26b","type":"switch","z":"ec66bca55939c9e9","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":520,"wires":[["f4bddae4bb753ad7"]]},{"id":"f4bddae4bb753ad7","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"maintanence needed\", \"\"]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":520,"wires":[["235d1415f23c0e83"]]},{"id":"5bf3eea765f7ca7a","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"quality\", msg.payload]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":240,"wires":[["d4c89f71c650dd32"]]},{"id":"7da9cf95e81e8a24","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"temperature\", msg.payload]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":320,"wires":[["d4c89f71c650dd32"]]},{"id":"13d27a83ec253b04","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"vibration\", msg.payload]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":400,"wires":[["d4c89f71c650dd32"]]},{"id":"ec6f58bccc8e19e3","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"calculateEfficiency","thingActionValue":"{\"uri\":\"http://localhost:1880/efficiencyanalyser\",\"params\":{},\"output\":{\"type\":\"integer\",\"description\":\"The calculated percentage efficiency of the system\"},\"description\":\"Calculates the efficiency of the system\",\"title\":\"Calculate efficiency\",\"action\":\"calculateEfficiency\"}","outputToMsg":true,"redeploy":"true","x":450,"y":580,"wires":[["12d9cfb76c387f6e"]]},{"id":"2de19fffe753196c","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertManager","thingActionValue":"{\"uri\":\"http://localhost:1880/managersdevice\",\"params\":{\"alertType\":\"string\",\"alertContent\":\"string\"},\"description\":\"Makes an alert on the manager's device\",\"title\":\"Alert the manager\",\"action\":\"alertManager\"}","outputToMsg":true,"redeploy":"true","x":810,"y":580,"wires":[[]]},{"id":"12d9cfb76c387f6e","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"efficiency\", msg.payload]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":580,"wires":[["2de19fffe753196c"]]},{"id":"fde4b9d9924374de","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertManager","thingActionValue":"{\"uri\":\"http://localhost:1880/managersdevice\",\"params\":{\"alertType\":\"string\",\"alertContent\":\"string\"},\"description\":\"Makes an alert on the manager's device\",\"title\":\"Alert the manager\",\"action\":\"alertManager\"}","outputToMsg":true,"redeploy":"true","x":550,"y":160,"wires":[[]]},{"id":"3bb0c2950a4e47f9","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"efficiency\", msg.payload]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":160,"wires":[["fde4b9d9924374de"]]},{"id":"452b85f545704436","type":"system-event-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"resourceUsed","thingEventValue":"{\"uri\":\"http://localhost:1880/inventorymanager\",\"output\":{\"type\":\"object\",\"properties\":{\"resourceName\":{\"type\":\"string\",\"description\":\"The name of the resource used\"},\"quantity\":{\"type\":\"number\",\"description\":\"The amount of the resource used\"}}},\"description\":\"Makes an alert when a resource is used\",\"title\":\"Resource used\",\"event\":\"resourceUsed\"}","outputToMsg":true,"redeploy":"false","x":110,"y":660,"wires":[["52a17da8edaf3685","cd8b7c2c05693627"]]},{"id":"cd8b7c2c05693627","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"logData","thingActionValue":"{\"uri\":\"http://localhost:1880/database\",\"params\":{},\"description\":\"Logs the input data\",\"title\":\"Log data\",\"action\":\"logData\"}","outputToMsg":true,"redeploy":"false","x":300,"y":720,"wires":[[]]},{"id":"d22fe9aed7bd0d6f","type":"system-action-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertManager","thingActionValue":"{\"uri\":\"http://localhost:1880/managersdevice\",\"params\":{\"alertType\":\"string\",\"alertContent\":\"string\"},\"description\":\"Makes an alert on the manager's device\",\"title\":\"Alert the manager\",\"action\":\"alertManager\"}","outputToMsg":true,"redeploy":"true","x":490,"y":660,"wires":[[]]},{"id":"52a17da8edaf3685","type":"change","z":"ec66bca55939c9e9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[\"resourceUsed\", msg.payload]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":660,"wires":[["d22fe9aed7bd0d6f"]]},{"id":"544dac9b227bb08f","type":"system-event-node","z":"ec66bca55939c9e9","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"dataProcessingComplete","thingEventValue":"{\"uri\":\"http://localhost:1880/sensorhub\",\"output\":{\"type\":\"string\",\"description\":\"Status information about the current state of the system\"},\"description\":\"Makes a notification when sensor data processing is complete\",\"title\":\"Data processing complete\",\"event\":\"dataProcessingComplete\"}","outputToMsg":true,"redeploy":"true","x":150,"y":520,"wires":[["dd07b6d2c9d8508c","4d34410bcd990e0f","ec6f58bccc8e19e3"]]}]
"""

manufacturing_td_simple = """
  [{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Database","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"logData":{"type":"","title":"Log data","description":"Logs the input data","input":{"type":"string","description":"The data to be logged"},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"EfficiencyAnalyser","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"calculateEfficiency":{"type":"","title":"Calculate efficiency","description":"Calculates the efficiency of the system","input":{"type":"string","description":"The status of the system"},"output":{"type":"integer","description":"The calculated percentage efficiency of the system"},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"InventoryManager","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"resourceUsed":{"title":"Resource used","description":"Makes an alert when a resource is used","subscription":{},"data":{"type":"object","properties":{"resourceName":{"type":"string","description":"The name of the resource used"},"quantity":{"type":"number","description":"The amount of the resource used"}}},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"MaintenanceMonitor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"reviewForMaintenance":{"type":"","title":"Review for maintenance","description":"Reviews a system's status for issues that may need maintenance","input":{"type":"string","description":"The status of the system"},"output":{"type":"boolean","description":"Whether or not the system needs maintenance"},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"ManagersDevice","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"alertManager":{"type":"","title":"Alert the manager","description":"Makes an alert on the manager's device","input":{"type":"object","properties":{"alertType":{"type":"string","description":"The type of alert to produce on the target device"},"alertContent":{"type":"string","description":"The contents of the alert being created"}}},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"QualityInspector","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"newQualityData":{"title":"New quality data","description":"Alerts when new quality data is ready for processing","subscription":{},"data":{"type":"string","description":"Details about the quality of products"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"SensorHub","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"processSensorData":{"type":"","title":"Process sensor data","description":"Adds the provided sensor data for processing","input":{"type":"object","properties":{"sensorName":{"type":"string","description":"The name of the sensor"},"data":{"type":"string","description":"The data for the sensor to be processed"}}},"forms":[]}},"properties":{},"events":{"dataProcessingComplete":{"title":"Data processing complete","description":"Makes a notification when sensor data processing is complete","subscription":{},"data":{"type":"string","description":"Status information about the current state of the system"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"TemperatureTracker","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"temperatureAlert":{"title":"Temperature alert","description":"Produces an alert with the current temperature of machines","subscription":{},"data":{"type":"number","description":"The current temperature of machines"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"VibrationMonitor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"vibrationAlert":{"title":"Vibration alert","description":"Created a notification of the current vibration of machines","subscription":{},"data":{"type":"number","description":"The amplitude of the current vibration of the machines"},"cancellation":{},"forms":[]}}}]
"""


smart_aquarium_system_description = """
  If the tank’s pH level is out of the required range add either crushed coral (raising the pH) or CO2 (lowering the pH) to the water.

  When the temperature becomes out of range utilise the heater and cooler to return the temperature to the optimum value.

  If salinity or nitrate levels become too low, add salt or potassium nitrate respectively.

  An automated feeder dispenses food at scheduled times. If the food storage in the feeder is running low, the system alerts the owner.

  The system controls the aquarium’s lighting based on the time of day to simulate natural light conditions. The owner should be able to alter the profile of the lights.

  If the tank’s filter is clogged or not working efficiently, the system alerts the owner and schedules a cleaning or replacement.

  If any abnormal behavior or potential health issues are detected within the tank, the owner is alerted.

  The system keeps track of maintenance tasks such as water changes, filter replacements, and general cleaning. It sends reminders to the owner when these tasks are due.

  In case of a power outage, the system switches to a backup power supply. It also alerts the owner of the situation.

  The owner can access real-time data on water conditions, view live camera feeds, and manually dispense food through a smartphone app.
"""


smart_aquarium_expected_output = """
  [{"id":"dd0dd247be6b2ef1","type":"tab","label":"Flow 9","disabled":false,"info":"","env":[]},{"id":"384362912a7251d4","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"pHLevel","thingEventValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"output\":{\"type\":\"number\",\"description\":\"The pH level\"},\"description\":\"A periodic report of the pH level of the tank's water\",\"title\":\"pH Level\",\"event\":\"pHLevel\"}","outputToMsg":true,"redeploy":"true","x":80,"y":60,"wires":[["704e1a9a04f42d9d"]]},{"id":"73b0a8dcb932a87a","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"temperature","thingEventValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"output\":{\"type\":\"number\",\"description\":\"The temperature of the water\"},\"description\":\"A periodic notification of the current water temperature of the tank\",\"title\":\"Temperature\",\"event\":\"temperature\"}","outputToMsg":true,"redeploy":"false","x":90,"y":200,"wires":[["27a56a43b84c407f"]]},{"id":"91b2c2f567d00b4e","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"salinity","thingEventValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"output\":{\"type\":\"number\",\"description\":\"The concentration of salt in the water\"},\"description\":\"The current concentration of salt in the tank's water\",\"title\":\"Salinity\",\"event\":\"salinity\"}","outputToMsg":true,"redeploy":"false","x":70,"y":340,"wires":[["cd61dd9705134567"]]},{"id":"ed43bfa29768163f","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"nitrateLevel","thingEventValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"output\":{\"type\":\"number\",\"description\":\"The amount of nitrates\"},\"description\":\"Notification of the current amount of nitrate in the tank water\",\"title\":\"Nitrate Level\",\"event\":\"nitrateLevel\"}","outputToMsg":true,"redeploy":"false","x":90,"y":400,"wires":[["0e24031fba26970e"]]},{"id":"704e1a9a04f42d9d","type":"switch","z":"dd0dd247be6b2ef1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"6.5","vt":"num"},{"t":"gt","v":"9","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":60,"wires":[["aa916e90b680d015"],["9efc326c7e9210f1"]]},{"id":"27a56a43b84c407f","type":"switch","z":"dd0dd247be6b2ef1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"24","vt":"num"},{"t":"gt","v":"26.5","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":200,"wires":[["7e0760ac4186a2da","88b7778812283dfa"],["d35b98f14f947756","b5e31837a6e77620"]]},{"id":"cd61dd9705134567","type":"switch","z":"dd0dd247be6b2ef1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"1.028","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":340,"wires":[["ad4732e621d596c1"]]},{"id":"0e24031fba26970e","type":"switch","z":"dd0dd247be6b2ef1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"70","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":400,"wires":[["f21817eca047c970"]]},{"id":"bffe5ef6ccb1f67d","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"dispenseChemical","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{\"chemical\":\"string\",\"amount\":\"number\"},\"description\":\"Dispenses the specified chemical into the water tank\",\"title\":\"Dispense Chemical\",\"action\":\"dispenseChemical\"}","outputToMsg":true,"redeploy":"true","x":610,"y":40,"wires":[[]]},{"id":"aa916e90b680d015","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"Chemical\":\"Crushed Coral\", \"amount\":\"5ppm\"}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":40,"wires":[["bffe5ef6ccb1f67d"]]},{"id":"9c3f2fd267b7ce16","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"dispenseChemical","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{\"chemical\":\"string\",\"amount\":\"number\"},\"description\":\"Dispenses the specified chemical into the water tank\",\"title\":\"Dispense Chemical\",\"action\":\"dispenseChemical\"}","outputToMsg":true,"redeploy":"true","x":610,"y":80,"wires":[[]]},{"id":"9efc326c7e9210f1","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"Chemical\":\"CO2\", \"amount\":\"5ppm\"}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":80,"wires":[["9c3f2fd267b7ce16"]]},{"id":"c3e419307a07877a","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"heaterOn","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{},\"description\":\"Turns the water heater on\",\"title\":\"Heater On\",\"action\":\"heaterOn\"}","outputToMsg":true,"redeploy":"true","x":580,"y":140,"wires":[[]]},{"id":"d35b98f14f947756","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"heaterOff","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{},\"description\":\"Turns the water heater off\",\"title\":\"Heater Off\",\"action\":\"heaterOff\"}","outputToMsg":true,"redeploy":"false","x":400,"y":240,"wires":[[]]},{"id":"88b7778812283dfa","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"CoolerOff","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{},\"description\":\"Turns the water cooler off\",\"title\":\"Cooler Off\",\"action\":\"CoolerOff\"}","outputToMsg":true,"redeploy":"false","x":400,"y":180,"wires":[[]]},{"id":"dcc7aa2a4aaf5d0d","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"CoolerOn","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{},\"description\":\"Turns the water cooler on\",\"title\":\"Cooler On\",\"action\":\"CoolerOn\"}","outputToMsg":true,"redeploy":"true","x":580,"y":280,"wires":[[]]},{"id":"7e0760ac4186a2da","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"(24+26.5)/2","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":140,"wires":[["c3e419307a07877a"]]},{"id":"3770fca3dc72a0ae","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"dispenseChemical","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{\"chemical\":\"string\",\"amount\":\"number\"},\"description\":\"Dispenses the specified chemical into the water tank\",\"title\":\"Dispense Chemical\",\"action\":\"dispenseChemical\"}","outputToMsg":true,"redeploy":"true","x":610,"y":340,"wires":[[]]},{"id":"dd960a729ab1cecc","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"dispenseChemical","thingActionValue":"{\"uri\":\"http://localhost:1880/tankactuators\",\"params\":{\"chemical\":\"string\",\"amount\":\"number\"},\"description\":\"Dispenses the specified chemical into the water tank\",\"title\":\"Dispense Chemical\",\"action\":\"dispenseChemical\"}","outputToMsg":true,"redeploy":"true","x":610,"y":400,"wires":[[]]},{"id":"f21817eca047c970","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"chemical\":\"potassium nitrate\", \"amount\":\"5ppm\"}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":400,"wires":[["dd960a729ab1cecc"]]},{"id":"50c555922071bea9","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"lowFoodLevel","thingEventValue":"{\"uri\":\"http://localhost:1880/fooddispensor\",\"output\":{},\"description\":\"A notification that the food dispensor is almost empty\",\"title\":\"Low Food Level\",\"event\":\"lowFoodLevel\"}","outputToMsg":true,"redeploy":"true","x":90,"y":500,"wires":[["6d40e32b4e5c58e5"]]},{"id":"6d40e32b4e5c58e5","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"owner\",\"message\":\"Food dispensor nearly empty\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":500,"wires":[["8fccdc68037fccc3"]]},{"id":"8fccdc68037fccc3","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertRole","thingActionValue":"{\"uri\":\"http://localhost:1880/alertsystem\",\"params\":{\"role\":\"string\",\"message\":\"string\"},\"description\":\"Alerts a system role with the provided message/data\",\"title\":\"Alert Role\",\"action\":\"alertRole\"}","outputToMsg":true,"redeploy":"false","x":420,"y":500,"wires":[[]]},{"id":"9d3c06c65cb28324","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"time","thingEventValue":"{\"uri\":\"http://localhost:1880/clock\",\"output\":{\"type\":\"number\",\"description\":\"The time\"},\"description\":\"The current time\",\"title\":\"Time\",\"event\":\"time\"}","outputToMsg":true,"redeploy":"false","x":70,"y":580,"wires":[["81c93adb2c01e1f2"]]},{"id":"81c93adb2c01e1f2","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"notifyLightingOfTime","thingActionValue":"{\"uri\":\"http://localhost:1880/tanklighting\",\"params\":{},\"description\":\"Notifies this lighting unit of the current time (enabling synchronisation by an external time keeper)\",\"title\":\"Notify Lighting Of Time\",\"action\":\"notifyLightingOfTime\"}","outputToMsg":true,"redeploy":"true","x":240,"y":580,"wires":[[]]},{"id":"68bf31db32e04b0d","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"filterIssue","thingEventValue":"{\"uri\":\"http://localhost:1880/filtermonitor\",\"output\":{},\"description\":\"A notification made when an issue with the filter is detected, preventing it from correctly functioning\",\"title\":\"Filter Issue\",\"event\":\"filterIssue\"}","outputToMsg":true,"redeploy":"true","x":80,"y":680,"wires":[["278b5929a6f8c6aa","98cd8e8dd102280e"]]},{"id":"4ab3506ffcb80284","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertRole","thingActionValue":"{\"uri\":\"http://localhost:1880/alertsystem\",\"params\":{\"role\":\"string\",\"message\":\"string\"},\"description\":\"Alerts a system role with the provided message/data\",\"title\":\"Alert Role\",\"action\":\"alertRole\"}","outputToMsg":true,"redeploy":"false","x":400,"y":680,"wires":[[]]},{"id":"278b5929a6f8c6aa","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"maintanence\",\"task\":\"Clean/repair the tank's filter system\"}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":720,"wires":[["c0967ecc94d37cdd"]]},{"id":"c0967ecc94d37cdd","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"scheduleTask","thingActionValue":"{\"uri\":\"http://localhost:1880/scheduler\",\"params\":{\"role\":\"string\",\"task\":\"string\"},\"description\":\"Schedules a task to be carried out by a specific system role\",\"title\":\"Schedule Task\",\"action\":\"scheduleTask\"}","outputToMsg":true,"redeploy":"true","x":420,"y":720,"wires":[[]]},{"id":"8a95ea516f8faa23","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"abnormalActivity","thingEventValue":"{\"uri\":\"http://localhost:1880/lifeformmonitor\",\"output\":{\"type\":\"object\",\"properties\":{\"lifeform\":{\"type\":\"string\",\"description\":\"The identification of the lifeform causing abnormal activity\"},\"details\":{\"type\":\"string\",\"description\":\"Details about the activity\"}}},\"description\":\"An event notifying when there is abnormal activity within the tank\",\"title\":\"Abnormal Activity\",\"event\":\"abnormalActivity\"}","outputToMsg":true,"redeploy":"false","x":100,"y":780,"wires":[["21eff32a824b14ef"]]},{"id":"0505536b04185b24","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertRole","thingActionValue":"{\"uri\":\"http://localhost:1880/alertsystem\",\"params\":{\"role\":\"string\",\"message\":\"string\"},\"description\":\"Alerts a system role with the provided message/data\",\"title\":\"Alert Role\",\"action\":\"alertRole\"}","outputToMsg":true,"redeploy":"false","x":440,"y":780,"wires":[[]]},{"id":"44f83bc37aa285f0","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"healthIssuesDetected","thingEventValue":"{\"uri\":\"http://localhost:1880/lifeformmonitor\",\"output\":{\"type\":\"object\",\"properties\":{\"lifeform\":{\"type\":\"string\",\"description\":\"The identification of the lifeform\"},\"details\":{\"type\":\"string\",\"description\":\"Details about the health event\"}}},\"description\":\"An event notifying of a health issue for one of the lifeforms\",\"title\":\"Health Issues Detected\",\"event\":\"healthIssuesDetected\"}","outputToMsg":true,"redeploy":"true","x":120,"y":820,"wires":[["9fbab2aeeb7a885a"]]},{"id":"9115a735d28f1324","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertRole","thingActionValue":"{\"uri\":\"http://localhost:1880/alertsystem\",\"params\":{\"role\":\"string\",\"message\":\"string\"},\"description\":\"Alerts a system role with the provided message/data\",\"title\":\"Alert Role\",\"action\":\"alertRole\"}","outputToMsg":true,"redeploy":"false","x":480,"y":820,"wires":[[]]},{"id":"652d1f1d7375127f","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"regularMaintenanceRequired","thingEventValue":"{\"uri\":\"http://localhost:1880/scheduler\",\"output\":{\"type\":\"object\",\"properties\":{\"task\":{\"type\":\"string\",\"description\":\"The description of the task\"},\"dueDate\":{\"type\":\"number\",\"description\":\"The time that the task must be completed by\"}}},\"description\":\"An alert for regular tank maintenance\",\"title\":\"Regular Maintenance Required\",\"event\":\"regularMaintenanceRequired\"}","outputToMsg":true,"redeploy":"false","x":140,"y":880,"wires":[["42e9994219cd6974"]]},{"id":"241353cbbaa17ae9","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertRole","thingActionValue":"{\"uri\":\"http://localhost:1880/alertsystem\",\"params\":{\"role\":\"string\",\"message\":\"string\"},\"description\":\"Alerts a system role with the provided message/data\",\"title\":\"Alert Role\",\"action\":\"alertRole\"}","outputToMsg":true,"redeploy":"false","x":520,"y":880,"wires":[[]]},{"id":"3ee68af6ea4ef9d2","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"powerOutage","thingEventValue":"{\"uri\":\"http://localhost:1880/outagedetector\",\"output\":{},\"description\":\"Notification of a power outage\",\"title\":\"Power Outage\",\"event\":\"powerOutage\"}","outputToMsg":true,"redeploy":"true","x":90,"y":940,"wires":[["99eae875e4fd3db3","9e6d1162de896c26"]]},{"id":"99eae875e4fd3db3","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"enableBackupPower","thingActionValue":"{\"uri\":\"http://localhost:1880/backuppower\",\"params\":{},\"description\":\"Enables the backup power source for the aquarium\",\"title\":\"Enable Backup Power\",\"action\":\"enableBackupPower\"}","outputToMsg":true,"redeploy":"true","x":300,"y":940,"wires":[[]]},{"id":"0ae56e10014dc092","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alertRole","thingActionValue":"{\"uri\":\"http://localhost:1880/alertsystem\",\"params\":{\"role\":\"string\",\"message\":\"string\"},\"description\":\"Alerts a system role with the provided message/data\",\"title\":\"Alert Role\",\"action\":\"alertRole\"}","outputToMsg":true,"redeploy":"false","x":440,"y":980,"wires":[[]]},{"id":"7b7b4a38b1769cc1","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"requestWaterConditions","thingEventValue":"{\"uri\":\"http://localhost:1880/userdevice\",\"output\":{},\"description\":\"An event produced when a user wishes to gather the current water conditions\",\"title\":\"Request Water Conditions\",\"event\":\"requestWaterConditions\"}","outputToMsg":true,"redeploy":"false","x":120,"y":1060,"wires":[["2b1df50473e1a59c"]]},{"id":"403b29e6c1adf318","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"accessCameraFeed","thingEventValue":"{\"uri\":\"http://localhost:1880/userdevice\",\"output\":{},\"description\":\"An event displaying the users intention to access the aquarium's camera system\",\"title\":\"Access Camera Feed\",\"event\":\"accessCameraFeed\"}","outputToMsg":true,"redeploy":"true","x":110,"y":1240,"wires":[["ce4bf359b093fef7"]]},{"id":"bbf31b501b651829","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"forceFoodDispense","thingEventValue":"{\"uri\":\"http://localhost:1880/userdevice\",\"output\":{\"type\":\"number\",\"description\":\"The amount of food to dispense\"},\"description\":\"Notification made when the user wishes to dispense food into the tank\",\"title\":\"Force Food Dispense\",\"event\":\"forceFoodDispense\"}","outputToMsg":true,"redeploy":"true","x":110,"y":1300,"wires":[["d117b18be1b4ae86"]]},{"id":"d117b18be1b4ae86","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"dispenseFood","thingActionValue":"{\"uri\":\"http://localhost:1880/fooddispensor\",\"params\":{},\"description\":\"Dispenses food into the tanks\",\"title\":\"Dispense Food\",\"action\":\"dispenseFood\"}","outputToMsg":true,"redeploy":"false","x":300,"y":1300,"wires":[[]]},{"id":"a89181438c266154","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"receiveWaterConditions","thingActionValue":"{\"uri\":\"http://localhost:1880/userdevice\",\"params\":{},\"description\":\"Passes the given water conditions to the user of this device\",\"title\":\"Receive Water Conditions\",\"action\":\"receiveWaterConditions\"}","outputToMsg":true,"redeploy":"true","x":1110,"y":1100,"wires":[[]]},{"id":"d17578f4da7ab001","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"receiveCameraConnection","thingActionValue":"{\"uri\":\"http://localhost:1880/userdevice\",\"params\":{},\"description\":\"Passes details to the user's application for establishing a camera connection\",\"title\":\"Receive Camera Connection\",\"action\":\"receiveCameraConnection\"}","outputToMsg":true,"redeploy":"false","x":560,"y":1240,"wires":[[]]},{"id":"ce4bf359b093fef7","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"getCameraConnection","thingActionValue":"{\"uri\":\"http://localhost:1880/tankcameras\",\"params\":{},\"output\":{\"title\":\"string\",\"description\":\"Details of the camera feed connection\"},\"description\":\"Fetches a connection to the tank camera feed\",\"title\":\"Get Camera Connection\",\"action\":\"getCameraConnection\"}","outputToMsg":true,"redeploy":"false","x":320,"y":1240,"wires":[["d17578f4da7ab001"]]},{"id":"2b1df50473e1a59c","type":"system-property-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingProperty":"","thingPropertyValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"type\":\"number\",\"description\":\"The pH Level of the water in the tank\",\"title\":\"pH level\",\"property\":\"pHLevel\"}","mode":"read","redeploy":"false","x":340,"y":1060,"wires":[["0c16560a85c21baa"]]},{"id":"b31f67526f9712e0","type":"system-property-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingProperty":"temperature","thingPropertyValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"type\":\"number\",\"description\":\"The temperature of the water in the tank\",\"title\":\"Temperature\",\"property\":\"temperature\"}","mode":"read","redeploy":"true","x":350,"y":1100,"wires":[["2ca4cf68efec89b7"]]},{"id":"cf10365d9433c41e","type":"system-property-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingProperty":"salinity","thingPropertyValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"type\":\"number\",\"description\":\"The salinity of the water in the tank\",\"title\":\"Salinity\",\"property\":\"salinity\"}","mode":"read","redeploy":"true","x":330,"y":1140,"wires":[["d684c5daab02922e"]]},{"id":"35c9ac889a4c6b17","type":"system-property-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingProperty":"nitrateLevel","thingPropertyValue":"{\"uri\":\"http://localhost:1880/tanksensors\",\"type\":\"number\",\"description\":\"The amount of nitrates in the tank's water\",\"title\":\"Nitrate Level\",\"property\":\"nitrateLevel\"}","mode":"read","redeploy":"true","x":350,"y":1180,"wires":[["a4f72673bf7fa30f"]]},{"id":"0c16560a85c21baa","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"tankProperties[\"pHLevel\"]","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1060,"wires":[["b31f67526f9712e0"]]},{"id":"2ca4cf68efec89b7","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"tankProperties[\"temperature\"]","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1100,"wires":[["cf10365d9433c41e"]]},{"id":"d684c5daab02922e","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"tankProperties[\"salinity\"]","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1140,"wires":[["35c9ac889a4c6b17"]]},{"id":"a4f72673bf7fa30f","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"tankProperties[\"nitrateLevel\"]","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1180,"wires":[["46e78336967a82fd"]]},{"id":"46e78336967a82fd","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"tankProperties","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":1100,"wires":[["a89181438c266154"]]},{"id":"b5e31837a6e77620","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"(24+26.5)/2","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":280,"wires":[["dcc7aa2a4aaf5d0d"]]},{"id":"ad4732e621d596c1","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"Chemical\":\"Salt\", \"amount\":\"5ppm\"}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":340,"wires":[["3770fca3dc72a0ae"]]},{"id":"98cd8e8dd102280e","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"owner\",\"message\":\"Tank filter malfunction\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":680,"wires":[["4ab3506ffcb80284"]]},{"id":"21eff32a824b14ef","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"owner\",\"message\":\"Abnormal behaviour detected from \" + msg.payload[\"lifeform\"] + \". Details:\" + msg.payload[\"details\"]}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":780,"wires":[["0505536b04185b24"]]},{"id":"42e9994219cd6974","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"owner\",\"message\":\"Regular maintanence task \" + msg.payload[\"task\"] + \" due to be completed by \" + msg.payload[\"dueDate\"]}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":880,"wires":[["241353cbbaa17ae9"]]},{"id":"9e6d1162de896c26","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"owner\",\"message\":\"A power outage was detected, enabling backup power supply\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":980,"wires":[["0ae56e10014dc092"]]},{"id":"9fbab2aeeb7a885a","type":"change","z":"dd0dd247be6b2ef1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"role\":\"owner\",\"message\":\"Health issue detected for \" + msg.payload[\"lifeform\"] + \". Details:\" + msg.payload[\"details\"]}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":820,"wires":[["9115a735d28f1324"]]},{"id":"a87d65fb7f36b768","type":"system-event-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingEvent":"uploadLightingProfile","thingEventValue":"{\"uri\":\"http://localhost:1880/userdevice\",\"output\":{\"type\":\"string\",\"description\":\"The new lighting profile\"},\"description\":\"An event made when the user wishes to establish a new lighting profile\",\"title\":\"Upload Lighting Profile\",\"event\":\"uploadLightingProfile\"}","outputToMsg":true,"redeploy":"false","x":120,"y":620,"wires":[["047eb888c4e11732"]]},{"id":"047eb888c4e11732","type":"system-action-node","z":"dd0dd247be6b2ef1","name":"","thingDirectoryURI":"http://localhost:1880/thingdirectory","thingAction":"alterLightingProfile","thingActionValue":"{\"uri\":\"http://localhost:1880/tanklighting\",\"params\":{},\"description\":\"Alters the profile of the lighting strength against time\",\"title\":\"Alter Lighting Profile\",\"action\":\"alterLightingProfile\"}","outputToMsg":true,"redeploy":"true","x":330,"y":620,"wires":[[]]}]
"""


smart_aquarium_td_simple = """
  [{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"AlertSystem","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"alertRole":{"type":"","title":"Alert Role","description":"Alerts a system role with the provided message/data","input":{"type":"object","properties":{"role":{"type":"string","description":"The system role to be alerted"},"message":{"type":"string","description":"the message to be sent to the given role"}}},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"BackupPower","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"enableBackupPower":{"type":"","title":"Enable Backup Power","description":"Enables the backup power source for the aquarium","forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Clock","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"time":{"title":"Time","description":"The current time","subscription":{},"data":{"type":"number","description":"The time"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"FilterMonitor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"filterIssue":{"title":"Filter Issue","description":"A notification made when an issue with the filter is detected, preventing it from correctly functioning","subscription":{},"data":{},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"FoodDispensor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"dispenseFood":{"title":"Dispense Food","description":"Dispenses food into the tanks","subscription":{},"input":{"type":"number","description":"The amount of food to be dispensed"},"cancellation":{},"forms":[]}},"properties":{},"events":{"lowFoodLevel":{"title":"Low Food Level","description":"A notification that the food dispensor is almost empty","subscription":{},"data":{},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"LifeformMonitor","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"abnormalActivity":{"title":"Abnormal Activity","description":"An event notifying when there is abnormal activity within the tank","subscription":{},"data":{"type":"object","properties":{"lifeform":{"type":"string","description":"The identification of the lifeform causing abnormal activity"},"details":{"type":"string","description":"Details about the activity"}}},"cancellation":{},"forms":[]},"healthIssuesDetected":{"title":"Health Issues Detected","description":"An event notifying of a health issue for one of the lifeforms","subscription":{},"data":{"type":"object","properties":{"lifeform":{"type":"string","description":"The identification of the lifeform"},"details":{"type":"string","description":"Details about the health event"}}},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"OutageDetector","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{},"events":{"powerOutage":{"title":"Power Outage","description":"Notification of a power outage","subscription":{},"data":{},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"Scheduler","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"scheduleTask":{"type":"","title":"Schedule Task","description":"Schedules a task to be carried out by a specific system role","input":{"type":"object","properties":{"role":{"type":"string","description":"The system role for which the task is to be scheduled for"},"task":{"type":"string","description":"The description of the task the be scheduled"}}},"forms":[]}},"properties":{},"events":{"regularMaintenanceRequired":{"title":"Regular Maintenance Required","description":"An alert for regular tank maintenance","subscription":{},"data":{"type":"object","properties":{"task":{"type":"string","description":"The description of the task"},"dueDate":{"type":"number","description":"The time that the task must be completed by"}}},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"TankActuators","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"heaterOn":{"type":"","title":"Heater On","description":"Turns the water heater on","input":{"type":"number","description":"The target temperature of the water"},"forms":[]},"heaterOff":{"type":"","title":"Heater Off","description":"Turns the water heater off","forms":[]},"CoolerOn":{"type":"","title":"Cooler On","description":"Turns the water cooler on","input":{"type":"number","description":"The target temperature of the water"},"forms":[]},"CoolerOff":{"type":"","title":"Cooler Off","description":"Turns the water cooler off","forms":[]},"dispenseChemical":{"type":"","title":"Dispense Chemical","description":"Dispenses the specified chemical into the water tank","input":{"type":"object","properties":{"chemical":{"type":"string","description":"The chemical to release into the water"},"amount":{"type":"number","description":"The amount of the specified chamical to be released"}}},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"TankCameras","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"getCameraConnection":{"type":"","title":"Get Camera Connection","description":"Fetches a connection to the tank camera feed","output":{"title":"string","description":"Details of the camera feed connection"},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"TankLighting","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"alterLightingProfile":{"type":"","title":"Alter Lighting Profile","description":"Alters the profile of the lighting strength against time","input":{"type":"string","description":"The new lighting profile"},"forms":[]},"resetLightingProfile":{"type":"","title":"Reset Lighting Profile","description":"Resets the lighting profile for the tank lights","forms":[]},"notifyLightingOfTime":{"type":"","title":"Notify Lighting Of Time","description":"Notifies this lighting unit of the current time (enabling synchronisation by an external time keeper)","input":{"type":"number","description":"The current time"},"forms":[]}},"properties":{},"events":{}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"TankSensors","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{},"properties":{"pHLevel":{"type":"number","title":"pH level","description":"The pH Level of the water in the tank","forms":[]},"temperature":{"type":"number","title":"Temperature","description":"The temperature of the water in the tank","forms":[]},"salinity":{"type":"number","title":"Salinity","description":"The salinity of the water in the tank","forms":[]},"nitrateLevel":{"type":"number","title":"Nitrate Level","description":"The amount of nitrates in the tank's water","forms":[]}},"events":{"pHLevel":{"title":"pH Level","description":"A periodic report of the pH level of the tank's water","subscription":{},"data":{"type":"number","description":"The pH level"},"cancellation":{},"forms":[]},"temperature":{"title":"Temperature","description":"A periodic notification of the current water temperature of the tank","subscription":{},"data":{"type":"number","description":"The temperature of the water"},"cancellation":{},"forms":[]},"salinity":{"title":"Salinity","description":"The current concentration of salt in the tank's water","subscription":{},"data":{"type":"number","description":"The concentration of salt in the water"},"cancellation":{},"forms":[]},"nitrateLevel":{"title":"Nitrate Level","description":"Notification of the current amount of nitrate in the tank water","subscription":{},"data":{"type":"number","description":"The amount of nitrates"},"cancellation":{},"forms":[]}}},{"@context":["http://www.w3.org/ns/td"],"@type":["Thing"],"title":"UserDevice","securityDefinitions":{"no_sec":{"scheme":"nosec"}},"security":"no_sec","actions":{"receiveWaterConditions":{"type":"","title":"Receive Water Conditions","description":"Passes the given water conditions to the user of this device","forms":[]},"receiveCameraConnection":{"type":"","title":"Receive Camera Connection","description":"Passes details to the user's application for establishing a camera connection","input":{"type":"string","description":"Details for establishing a camera connection"},"forms":[]}},"properties":{},"events":{"requestWaterConditions":{"title":"Request Water Conditions","description":"An event produced when a user wishes to gather the current water conditions","subscription":{},"data":{},"cancellation":{},"forms":[]},"accessCameraFeed":{"title":"Access Camera Feed","description":"An event displaying the users intention to access the aquarium's camera system","subscription":{},"data":{},"cancellation":{},"forms":[]},"uploadLightingProfile":{"title":"Upload Lighting Profile","description":"An event made when the user wishes to establish a new lighting profile","subscription":{},"data":{"type":"string","description":"The new lighting profile"},"cancellation":{},"forms":[]},"forceFoodDispense":{"title":"Force Food Dispense","description":"Notification made when the user wishes to dispense food into the tank","subscription":{},"data":{"type":"number","description":"The amount of food to dispense"},"cancellation":{},"forms":[]}}}]
"""